# データベースのマイグレートとは？（初心者向け）

## マイグレートとは？

**マイグレート**とは、データベースにテーブル（表）を作成したり、変更したりする作業のことです。

### わかりやすく例えると

- **データベース** = 本棚
- **テーブル** = 本棚の中の引き出し
- **マイグレート** = 引き出しを作る作業

現在、Supabase（データベース）には「Session」という引き出し（テーブル）を作る必要があります。

## なぜ必要なのか？

アプリが動作するためには、データベースに「Session」というテーブルが必要です。

- このテーブルがないと、ユーザーがログインできません
- このテーブルがないと、アプリがエラーになります

## どこで実行するのか？

**ターミナル（コマンドライン）**で実行します。

ターミナルは、コンピューターに命令を出すための画面です。

## 具体的な手順

### ステップ1: Supabaseの接続文字列を取得

1. **Supabaseのウェブサイトにアクセス**
   - https://supabase.com にアクセス
   - ログイン

2. **プロジェクトを選択**
   - あなたが作成したプロジェクトをクリック

3. **接続文字列を取得**
   - 左側のメニューから「Settings」（設定）をクリック
   - 「Database」（データベース）をクリック
   - 「Connection string」セクションを開く
   - 「Direct connection」（直接接続）を選択
   - 「URI」を選択
   - 表示された文字列をコピー
   - 例: `postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres`

**重要**: 
- `[YOUR-PASSWORD]`の部分を、あなたが設定したパスワードに置き換えてください
- `db.xxxxx.supabase.co`の部分は、あなたのプロジェクトのURLになります

### ステップ2: ターミナルを開く

1. **Macの場合**
   - 「Spotlight検索」（⌘ + スペース）を開く
   - 「ターミナル」と入力してEnterキーを押す

2. **Windowsの場合**
   - 「コマンドプロンプト」または「PowerShell」を開く

### ステップ3: プロジェクトのフォルダに移動

ターミナルで、以下のコマンドを入力してEnterキーを押します：

```bash
cd /Users/hakkow_h/delivery-gift-lite
```

### ステップ4: マイグレートを実行

ターミナルで、以下のコマンドを入力してEnterキーを押します：

```bash
DATABASE_URL="postgresql://postgres:あなたのパスワード@db.xxxxx.supabase.co:5432/postgres" npx prisma migrate deploy
```

**重要**: 
- `あなたのパスワード`の部分を、Supabaseで設定したパスワードに置き換えてください
- `db.xxxxx.supabase.co`の部分を、Supabaseで取得した接続文字列のURLに置き換えてください

### ステップ5: 成功を確認

コマンドが成功すると、以下のようなメッセージが表示されます：

```
✅ Applied migration: 20240530213853_create_session_table
```

## よくある質問

### Q: パスワードに特殊文字が含まれている場合は？

A: パスワードに特殊文字（`@`、`#`、`%`など）が含まれている場合、URLエンコードが必要です。

例: パスワードが `my@password#123` の場合
- `@` → `%40`
- `#` → `%23`
- 結果: `my%40password%23123`

### Q: エラーが出た場合は？

A: 以下のエラーが出た場合の対処法：

1. **`Can't reach database server`**
   - Supabaseの接続文字列が正しいか確認
   - 直接接続用のURL（`db.xxxxx.supabase.co`）を使用しているか確認

2. **`Table already exists`**
   - テーブルが既に存在する場合、このエラーは無視して大丈夫です

3. **`Invalid password`**
   - パスワードが正しいか確認
   - 特殊文字が含まれている場合、URLエンコードが必要

## まとめ

1. ✅ Supabaseの接続文字列を取得
2. ✅ ターミナルを開く
3. ✅ プロジェクトのフォルダに移動
4. ✅ マイグレートを実行
5. ✅ 成功を確認

これで、データベースにテーブルが作成され、アプリが正常に動作するようになります！

