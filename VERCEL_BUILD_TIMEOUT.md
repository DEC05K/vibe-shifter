# Vercelビルドが長時間かかる場合の対処法

## 通常のビルド時間

- **通常**: 2-5分程度
- **19分**: 異常に長い（何か問題がある可能性が高い）

## 考えられる原因

1. **Prismaのマイグレートが失敗している**
   - データベース接続がタイムアウトしている
   - マイグレートが無限ループに陥っている

2. **データベース接続の問題**
   - Supabaseの接続文字列が間違っている
   - データベースが一時的に停止している（無料プランの場合）

3. **ビルドプロセスが詰まっている**
   - 無限ループに陥っている
   - リソース不足

## 対処方法

### ステップ1: ビルドログを確認

1. **Vercelダッシュボードにアクセス**
   - https://vercel.com にログイン
   - プロジェクト `delivery-gift-lite` を選択

2. **ビルドログを確認**
   - 「Deployments」タブを開く
   - 現在のデプロイを選択
   - 「Build Logs」を開く
   - 最後のログメッセージを確認

### ステップ2: エラーメッセージを確認

ビルドログで以下を確認してください：

- **Prismaのマイグレートが実行されているか**
  - `prisma generate`が実行されているか
  - `prisma migrate deploy`が実行されているか
  - エラーメッセージが出ていないか

- **データベース接続エラーが出ていないか**
  - `Can't reach database server`
  - `Connection timeout`
  - `prepared statement already exists`

- **ビルドプロセスが止まっているか**
  - 最後のログメッセージが何分も前のもの
  - 同じメッセージが繰り返されている

### ステップ3: ビルドをキャンセルして再試行

ビルドが20分以上かかっている場合：

1. **ビルドをキャンセル**
   - デプロイの「...」メニューから「Cancel」を選択

2. **環境変数を確認**
   - `DATABASE_URL`が正しく設定されているか確認
   - Supabaseの直接接続用のURLを使用しているか確認

3. **再デプロイ**
   - 「Redeploy」をクリック
   - または、GitHubに再度プッシュ

### ステップ4: データベース接続を確認

Supabaseのデータベースが正常に動作しているか確認：

1. **Supabaseダッシュボードにアクセス**
   - https://supabase.com にログイン
   - プロジェクトを選択

2. **データベースの状態を確認**
   - 「Settings」> 「Database」を開く
   - データベースが稼働中か確認

3. **接続文字列を確認**
   - 「Connection string」> 「Direct connection」> 「URI」を選択
   - 接続文字列をコピー
   - Vercelの`DATABASE_URL`環境変数と一致しているか確認

## よくある問題と解決方法

### 問題1: Prismaのマイグレートがタイムアウト

**症状**: `prisma migrate deploy`が実行されず、ビルドが止まる

**解決方法**:
- Supabaseの直接接続用のURLを使用
- 接続文字列に`?connect_timeout=30`を追加

### 問題2: データベースが停止している

**症状**: `Can't reach database server`エラー

**解決方法**:
- Supabaseダッシュボードでデータベースを再起動
- 数分待ってから再デプロイ

### 問題3: ビルドプロセスが無限ループ

**症状**: 同じログメッセージが繰り返される

**解決方法**:
- ビルドをキャンセル
- `package.json`の`build`スクリプトを確認
- 再デプロイ

## まとめ

19分は異常に長いので、以下を確認してください：

1. ✅ ビルドログを確認（最重要）
2. ✅ エラーメッセージを確認
3. ✅ データベース接続を確認
4. ✅ 必要に応じてビルドをキャンセルして再試行

ビルドログの内容を共有していただければ、より具体的な解決方法を提案できます。

